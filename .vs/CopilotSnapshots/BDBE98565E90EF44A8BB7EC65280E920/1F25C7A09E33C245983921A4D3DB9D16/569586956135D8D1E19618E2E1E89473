using System;

namespace Movie_Ticket_Booking_System
{
    class Program
    {
        static void Main()
        {
            var myCinema = new Cinema();

            for (int i = 1; i <= 3; i++)
            {
                Console.WriteLine($"Enter data for Ticket {i}:");
                string name = ReadNonEmptyString("Movie Name: ");
                TicketType type = ReadEnumFromInt<TicketType>("Ticket Type (0=Standard, 1=VIP, 2=IMAX): ");
                char row = ReadCharLetter("Seat Row (A-Z): ");
                int num = ReadInt("Seat Number: ");
                decimal price = ReadDecimal("Price: ");

                myCinema.AddTicket(new Ticket(name, type, new Seat(row, num), price));
                Console.WriteLine();
            }

            Console.WriteLine("---------- All Tickets ----------");
            for (int i = 0; i < 3; i++)
            {
                Ticket? t = myCinema[i];
                if (t != null)
                    Console.WriteLine($"Ticket #{t.TicketId} | {t.MovieName} | {t.Type} | Seat: {t.Seat} | Price: {t.Price} EGP | After Tax: {t.PriceAfterTax:F1} EGP");
            }

            Console.WriteLine("\n========== Search by Movie ==========");
            Console.Write("Enter movie name to search: ");
            string? searchInput = Console.ReadLine();
            Ticket? found = !string.IsNullOrEmpty(searchInput) ? myCinema[searchInput] : null; 

            if (found != null)
                Console.WriteLine($"Found: Ticket #{found.TicketId} | {found.MovieName} | {found.Type} | Seat: {found.Seat} | Price: {found.Price} EGP");
            else
                Console.WriteLine("Movie not found.");

            Console.WriteLine($"\n========== Statistics ==========");
            Console.WriteLine($"Total Tickets Sold: {Ticket.GetTotalTicketsSold()}");
            Console.WriteLine($"Booking Reference 1: {BookingHelper.GenerateBookingReference()}");
            Console.WriteLine($"Booking Reference 2: {BookingHelper.GenerateBookingReference()}");

            double discountPrice = BookingHelper.CalcGroupDiscount(5, 80);
            Console.WriteLine($"\nGroup Discount (5 tickets x 80 EGP): {discountPrice} EGP (10% off applied)");
        }

        static string ReadNonEmptyString(string prompt)
        {
            string? s;
            do
            {
                Console.Write(prompt);
                s = Console.ReadLine();
            } while (string.IsNullOrWhiteSpace(s));
            return s!;
        }

        static T ReadEnumFromInt<T>(string prompt) where T : Enum
        {
            string? s;
            int n;
            do
            {
                Console.Write(prompt);
                s = Console.ReadLine();
            } while (!int.TryParse(s, out n) || !Enum.IsDefined(typeof(T), n));
            return (T)Enum.ToObject(typeof(T), n);
        }

        static char ReadCharLetter(string prompt)
        {
            string? s;
            char c;
            do
            {
                Console.Write(prompt);
                s = Console.ReadLine();
            } while (string.IsNullOrEmpty(s) || !char.TryParse(s!.Trim().ToUpperInvariant(), out c) || c < 'A' || c > 'Z');
            return c;
        }

        static int ReadInt(string prompt)
        {
            string? s;
            int n;
            do
            {
                Console.Write(prompt);
                s = Console.ReadLine();
            } while (!int.TryParse(s, out n));
            return n;
        }

        static decimal ReadDecimal(string prompt)
        {
            string? s;
            decimal d;
            do
            {
                Console.Write(prompt);
                s = Console.ReadLine();
            } while (!decimal.TryParse(s, out d));
            return d;
        }
    }
}


